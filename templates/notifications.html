{% load static %} {% load socials_extras %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Notifications - Social Books</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link rel="stylesheet" href="{% static 'styles.css' %}" />
  </head>
  <body class="bg-gray-100">
    <div class="container mx-auto max-w-2xl px-4 py-8">
      <div class="bg-white rounded-lg shadow-lg">
        <!-- Header -->
        <div class="border-b border-gray-200 px-6 py-4">
          <div class="flex items-center justify-between">
            <h1 class="text-2xl font-bold text-gray-900">
              <i class="fas fa-bell mr-2 text-blue-600"></i>Notifications
            </h1>
            <a
              href="{% url 'new_home' %}"
              class="text-blue-600 hover:text-blue-800 transition-colors"
            >
              <i class="fas fa-arrow-left mr-1"></i>Back to Home
            </a>
          </div>
        </div>

        <!-- Notifications List -->
        <div class="divide-y divide-gray-200">
          {% for notification in notifications %}
          <div
            class="px-6 py-4 hover:bg-gray-50 transition-colors {% if not notification.is_read %}bg-blue-50 border-l-4 border-blue-500{% endif %}"
          >
            <div class="flex items-start space-x-3">
              <!-- Profile Picture -->
              <div class="flex-shrink-0">
                {% if notification.sender.profile.profilepic %}
                <img
                  src="{{ notification.sender.profile.profilepic.url }}"
                  alt="{{ notification.sender.username }}"
                  class="w-10 h-10 rounded-full object-cover"
                />
                {% else %}
                <div
                  class="w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center"
                >
                  <i class="fas fa-user text-gray-600"></i>
                </div>
                {% endif %}
              </div>

              <!-- Notification Content -->
              <div class="flex-1 min-w-0">
                <div class="flex items-center space-x-2 mb-1">
                  <!-- Notification Icon -->
                  <span class="flex-shrink-0">
                    {% if notification.notification_type == 'like' %}
                    <i class="fas fa-heart text-red-500"></i>
                    {% elif notification.notification_type == 'unlike' %}
                    <i class="fas fa-heart-broken text-gray-500"></i>
                    {% elif notification.notification_type == 'comment' %}
                    <i class="fas fa-comment text-blue-500"></i>
                    {% elif notification.notification_type == 'follow' %}
                    <i class="fas fa-user-plus text-green-500"></i>
                    {% elif notification.notification_type == 'unfollow' %}
                    <i class="fas fa-user-minus text-red-500"></i>
                    {% elif notification.notification_type == 'post' %}
                    <i class="fas fa-plus-circle text-purple-500"></i>
                    {% endif %}
                  </span>

                  <!-- Message -->
                  <p class="text-sm text-gray-900 flex-1">
                    <span class="font-semibold text-blue-600"
                      >{{ notification.sender.username }}</span
                    >
                    {% if notification.notification_type == 'like' %}
                    <span class="text-red-600">liked</span> your post {% elif
                    notification.notification_type == 'unlike' %}
                    <span class="text-gray-600">unliked</span> your post {% elif
                    notification.notification_type == 'comment' %}
                    <span class="text-blue-600">commented</span> on your post {%
                    if notification.comment %} <br /><span
                      class="text-gray-600 italic"
                      >"{{ notification.comment.comment|truncatechars:50
                      }}"</span
                    >
                    {% endif %} 

                    <p>{% if notification.notification_type == 'follow' %}
                    <span class="text-green-600">started following</span> you</p>
                    <p>{% elif notification.notification_type == 'unfollow' %}
                    <span class="text-red-600">unfollowed</span> you</p>
                    {% elif notification.notification_type == 'post' %}
                    <span class="text-purple-600">shared</span> a new post {%
                    endif %}
                  </p>
                </div>

                <!-- Time and Actions -->
                <div class="flex items-center justify-between mt-1">
                  <span class="text-xs text-gray-500">
                    {{ notification.created_at|timesince }} ago
                  </span>

                  <!-- Action Links -->
                  <div class="flex space-x-2">
                    {% if notification.post %}
                    <a
                      href="{% url 'profile' pk=notification.post.user.username %}"
                      class="text-xs text-blue-600 hover:text-blue-800 transition-colors"
                    >
                      View Post
                    </a>
                    {% endif %}
                    <hr />
                    {% if notification.notification_type == 'follow' or
                    notification.notification_type == 'unfollow' %}
                    <a
                      href="{% url 'profile' pk=notification.sender.username %}"
                      class="text-xs text-blue-600 hover:text-blue-800 transition-colors"
                    >
                      View Profile
                    </a>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </div>
          {% empty %}
          <div class="px-6 py-12 text-center">
            <i class="fas fa-bell-slash text-4xl text-gray-400 mb-4"></i>
            <p class="text-gray-500 text-lg">No notifications yet</p>
            <p class="text-gray-400 text-sm">
              You'll see notifications here when people interact with your posts
            </p>
          </div>
          {% endfor %}
        </div>

        <!-- Load More (if needed) -->
        {% if notifications.count >= 50 %}
        <div class="border-t border-gray-200 px-6 py-4 text-center">
          <button class="text-blue-600 hover:text-blue-800 text-sm font-medium">
            Load More Notifications
          </button>
        </div>
        {% endif %}
      </div>
    </div>
  </body>
</html>
