{# prettier ignore-start #} {% load static %} {% load socials_extras %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="{% static 'home.js' %}?v=20250819"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="stylesheet" href="{% static 'styles.css' %}" />
  </head>
  <body class="flex flex-col">
    <!-- Hidden CSRF token for JavaScript -->
    {% csrf_token %}

    <!-- Header -->
    <header class="bg-white shadow-sm sticky border-b-4 border-blue-500 top-0 z-30">
      <div
        class="max-w-7xl mx-auto px-4 py-2 flex items-center justify-between"
      >
        <div class="flex items-center">
          <!-- Hamburger menu for mobile -->
          <button id="sidebarToggle" class="mr-2 md:hidden text-gray-600">
            <i class="fas fa-bars text-xl"></i>
          </button>
          <h1 class="text-2xl font-bold text-blue-600 mr-4">Social Book</h1>

          <!-- search bar -->
          <form action="/search" method="POST">
            {% csrf_token %}
            <div class="relative hidden md:block">
              <i
                class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500"
              ></i>
              <input
                type="text"
                name="username"
                placeholder="Search Friends"
                class="search-input pl-10"
              />
              <button
                type="submit"
                class="bg-blue-500 hover:bg-blue-600 border-none text-white px-4 py-2 rounded-full cursor-pointer transition-all duration-300 hover:-translate-y-0.5"
              >
                <i class="fa fa-search fa-1x"></i>
              </button>
            </div>
          </form>
        </div>

        <!-- notification and profile -->
        <div class="flex items-center space-x-4">
          <!-- Notification Sidebar Toggle Button -->
          <div class="relative">
            <button
              id="headerNotificationToggle"
              class="text-gray-600 hover:text-blue-500 p-2 rounded-full relative md:p-2"
              title="Toggle Notifications Sidebar"
            >
              <i class="fas fa-bell text-lg md:text-xl"></i>
            </button>
          </div>

          <!-- Profile Button -->
          <div class="relative">
            <button id="profileButton">
              <img
                src="{{ user.profile.profilepic.url }}"
                class="w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center"
              />
            </button>
            <div
              id="profileDropdown"
              class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 hidden z-50"
            >
              <a
                href="{% url 'profile' user.username %}"
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                >Profile</a
              >
              <a
                href="{% url 'settings' %}"
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                >Settings</a
              >
              <a
                href="{% url 'logout' %}"
                class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                >Log out</a
              >
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Overlay for left sidebar (mobile) -->
    <div
      id="sidebarOverlay"
      class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden"
    ></div>

    <div class="flex flex-1">
      <!-- Left Sidebar -->
      <aside
        id="sidebar"
        class="w-[280px] bg-white h-screen fixed z-20 overflow-y-auto"
      >
        <div class="p-4">
          <div class="flex justify-between items-center mb-3">
            <button
              id="closeSidebar"
              class="md:hidden text-gray-500 hover:bg-gray-100 p-2 rounded-full"
            >
              <i class="fas fa-times text-xl"></i>
            </button>
          </div>

          <div class="mb-6">
            <ul>
              <a href="/">
                <li class="sidebar-item flex items-center cursor-pointer">
                  <i
                    class="fas fa-home w-[36px] text-[20px] text-[#1b74e4]"
                  ></i>
                  <span>Home</span>
                </li>
              </a>
              <li class="sidebar-item flex items-center cursor-pointer">
                <i
                  class="fas fa-user-friends w-[36px] text-[20px] text-[#1b74e4]"
                ></i>
                <span>Friends</span>
              </li>
              <a href="search">
                <li class="sidebar-item flex items-center cursor-pointer">
                  <i
                    class="fas fa-search w-[36px] text-[20px] text-[#1b74e4]"
                  ></i>
                  <span>Search</span>
                </li>
              </a>
              <li class="sidebar-item flex items-center cursor-pointer">
                <i
                  class="fas fa-bookmark w-[36px] text-[20px] text-[#1b74e4]"
                ></i>
                <span>Saved</span>
              </li>
            </ul>
          </div>
        </div>
      </aside>

      <!-- Overlay for right sidebar -->
      <div
        id="rightSidebarOverlay"
        class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden"
      ></div>

      <!-- Main Content -->
      <main class="flex-1 md:ml-[280px] pt-4">
        {% block content %} {% endblock %}
      </main>

      <!-- Right Sidebar (Notifications) -->
      <aside
        id="rightSidebar"
        class="fixed top-0 right-0 bg-white h-screen w-20 z-40 overflow-y-auto p-4 shadow-lg"
      >
        <div class="flex justify-between items-center mb-6">
          <h3 class="font-semibold text-[20px]">Notifications</h3>
          <button
            id="closeRightSidebar"
            class="text-gray-500 hover:bg-gray-100 p-2 rounded-full"
          >
            <i class="fas fa-times text-xl"></i>
          </button>
        </div>

        <!-- Notifications -->
        <div class="mb-6">
          <h3 class="font-semibold mb-3 text-[17px] text-[#65676b]">
            Recent Activity ({{ notifications|length }} notifications)
          </h3>
          {% if notifications %}
          <div class="space-y-3">
            {% for notification in notifications %}
            <div
              class="flex items-start space-x-3 p-2 rounded hover:bg-gray-50 {% if not notification.is_read %}bg-blue-50{% endif %}"
              data-notification-id="{{ notification.id }}"
            >
              <!-- User Profile Picture -->
              <div class="flex-shrink-0">
                <img
                  src="{% if notification.sender.profile.profilepic and notification.sender.profile.profilepic.url %}{{ notification.sender.profile.profilepic.url }}{% else %}/media/profile_pics/blank-profile-picture.png{% endif %}"
                  class="w-8 h-8 rounded-full object-cover"
                  alt="{{ notification.sender.username }}"
                />
              </div>

              <!-- Notification Content -->
              <div class="flex-1 min-w-0">
                <p class="text-sm text-gray-900">
                  <span class="font-semibold text-black"
                    >{{ notification.sender.username }}</span
                  >
                  <!-- like Content -->
                  {% if notification.notification_type == 'like' %}
                  <span class="text-red-600">liked</span> your post
                  <!-- unlike Content -->
                  {% elif notification.notification_type == 'unlike' %}
                  <span class="text-red-600">unliked</span> your post
                  <!-- comment Content -->
                  {% elif notification.notification_type == 'comment' %}
                  <span class="text-blue-600">commented</span> on your post
                  <!-- follow Content -->
                  {% elif notification.notification_type == 'follow' %}
                  <span class="text-green-600">started following</span> you
                  <!-- unfollow Content -->
                  {% elif notification.notification_type == 'unfollow' %}
                  <span class="text-green-600">stopped following</span> you
                  <!-- newpost Content -->
                  {% elif notification.notification_type == 'post' %}
                  <span class="text-purple-600">shared</span> a new post
                  <!-- end Content -->
                  {% endif %}
                </p>
                <p class="text-xs text-gray-500 mt-1">
                  {{ notification.created_at|timesince }} ago
                </p>
              </div>

              <!-- Delete Notification Button -->
              <div class="flex-shrink-0">
                <button
                  onclick="deleteNotification({{ notification.id }})"
                  class="text-gray-500 hover:text-red-600 p-2 rounded-full hover:bg-gray-100 transition-all duration-200"
                  title="Delete notification"
                >
                  <i class="fas fa-times text-sm"></i>
                </button>
              </div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="text-center py-4">
            <p class="text-gray-500 text-sm">No notifications yet</p>
          </div>
          {% endif %}
        </div>

        <!-- Active Friends -->
        <div>
          <h3 class="font-semibold mb-3 text-[17px] text-[#65676b]">
            Friends You can follow
          </h3>
          {% for suggestion in suggestions %}
          <div class="grid grid-cols-3 gap-3">
            <div class="text-center">
              <div
                class="w-[100px] h-[100px] rounded-full bg-gray-300 flex items-center justify-center mx-auto mb-2 relative"
              >
                <a href="{% url 'profile' suggestion.username %}">
                  <img
                    src="{% if suggestion.profile.profilepic and suggestion.profile.profilepic.url %}{{ suggestion.profile.profilepic.url }}{% else %}/media/profile_pics/blank-profile-picture.png{% endif %}"
                    class="bg-gray-600 rounded-full w-30 h-30 object-cover hover:border-4 hover:border-blue-500"
                  />
                </a>
                <div class="active-dot"></div>
              </div>
              <p class="text-[23px]">{{ suggestion.username }}</p>
            </div>
            {% empty %}
            <div class="flex items-center justify-center py-6 text-secondary">
              <p>No suggestions available</p>
            </div>
          </div>
          {% endfor %}
        </div>
      </aside>
    </div>
  </body>
</html>
{# prettier ignore-end #}
