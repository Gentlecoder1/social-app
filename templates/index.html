{% load static %} {% load socials_extras %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="{% static 'favicon.png' %}" rel="icon" type="image/png" />
    <title>Home</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="{% static 'assets/css/icons.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/uikit.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/style.css' %}" />
    <link rel="stylesheet" href="{% static 'assets/css/tailwind.css' %}" />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <style>
      /* Only keeping essential animations and effects that can't be replicated with Tailwind */
      @layer utilities {
        .bg-gradient-dark {
          background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 50%, #2d2d2d 100%);
        }
        
        .bg-gradient-primary {
          background: linear-gradient(45deg, #667eea, #764ba2);
        }
        
        .backdrop-blur-header {
          backdrop-filter: blur(10px);
          background: rgba(30, 30, 30, 0.95);
        }
        
        .shadow-custom-header {
          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .shadow-custom-upload {
          box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .focus-custom-search:focus-within {
          box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
          border-color: rgba(102, 126, 234, 0.5);
        }
        
        .text-shadow-logo {
          text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .text-shadow-feed {
          text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        .text-shadow-feed-subtitle {
          text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .shadow-post {
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .shadow-post-hover {
          box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .shadow-toggle {
          box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
        }
        
        .shadow-toggle-hover {
          box-shadow: 0 8px 30px rgba(102, 126, 234, 0.6);
        }
        
        .border-avatar {
          border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .action-btn:hover {
          background-color: rgba(0, 0, 0, 0.05);
        }
        
        .gradient-search-focus {
          background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%);
          box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
        }
      }

      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: #2d2d2d;
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb {
        background: #667eea;
        border-radius: 10px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #5a6fd8;
      }

      /* Comment section animations */
      .comments-section {
        overflow: hidden;
        max-height: 0;
        opacity: 0;
        transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out;
      }

      .comments-section.show {
        opacity: 1;
      }

      /* Comment scroll container */
      .comments-scroll-container {
        max-height: 350px;
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: #667eea #f0f2f5;
      }

      .comments-scroll-container::-webkit-scrollbar {
        width: 6px;
      }

      .comments-scroll-container::-webkit-scrollbar-track {
        background: #f0f2f5;
        border-radius: 3px;
      }

      .comments-scroll-container::-webkit-scrollbar-thumb {
        background: #667eea;
        border-radius: 3px;
      }

      .comments-scroll-container::-webkit-scrollbar-thumb:hover {
        background: #5a6fd8;
      }

      /* Fade effect for scrollable content */
      .comments-fade-overlay {
        position: relative;
      }

      .comments-fade-overlay::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 20px;
        background: linear-gradient(transparent, rgba(255, 255, 255, 0.9));
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .comments-fade-overlay.show-fade::after {
        opacity: 1;
      }

      /* Comment icon hover effect */
      .comment-toggle-btn:hover .comment-icon {
        color: #3b82f6 !important;
        transform: scale(1.1);
        transition: all 0.2s ease-in-out;
      }
      
      /* Original post card styles preserved */
      .post-card {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 0.5rem;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: all 0.2s ease-in-out;
        margin-bottom: 1rem;
      }
      
      .post-card:hover {
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }
      
      /* Sidebar card styles */
      .sidebar-card {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        padding: 1.5rem;
        width: 20rem;
        position: sticky;
        top: 6rem;
        max-height: calc(100vh - 8rem);
        overflow-y: auto;
      }
      
      .sidebar-card-header {
        border-bottom: 1px solid #e5e7eb;
        padding-bottom: 1rem;
        margin-bottom: 1rem;
      }
      
      .sidebar-card-header h2 {
        font-size: 1.25rem;
        font-weight: 700;
        color: #1f2937;
        margin: 0;
      }
    </style>
  </head>

  <body class="font-sans bg-gradient-dark m-0 p-0 min-h-screen box-border">
    <header class="backdrop-blur-header shadow-custom-header border-b border-white border-opacity-10 sticky top-0 z-50">
      <div class="header_inner flex justify-between items-center p-4 lg:px-8 max-w-6xl mx-auto w-full">
        <form action="/search" method="POST">
          {% csrf_token %}
          <div class="left-side flex items-center gap-8 flex-1">
            <!-- Logo -->
            <div id="logo" class="flex-shrink-0">
              <a href="{% url 'home' %}" class="no-underline">
                <h1 class="text-white m-0 text-2xl font-bold text-shadow-logo">Social Book</h1>
              </a>
            </div>

            <div
              class="triger"
              uk-toggle="target: #wrapper ; cls: sidebar-active"
            >
              <i class="uil-bars"></i>
            </div>

            <!-- Search -->
            <div class="search-container relative flex items-center bg-gray-800 bg-opacity-90 border border-white border-opacity-20 rounded-full px-4 py-2 shadow-lg transition-all duration-300 flex-1 max-w-sm focus-within:gradient-search-focus">
              <input
                type="text"
                name="username"
                placeholder="Search for username.."
                class="search-input border-none outline-none p-2 text-base flex-1 min-w-48 lg:min-w-52 bg-transparent text-white placeholder-white placeholder-opacity-60"
              />
              <button type="submit" class="bg-blue-500 hover:bg-blue-600 border-none text-white px-4 py-2 rounded-full cursor-pointer transition-all duration-300 hover:-translate-y-0.5">
                <i class="fa fa-search fa-1x"></i>
              </button>
            </div>
          </div>
        </form>
        <div class="right-side flex items-center gap-6 flex-shrink-0">
          <!-- upload -->
          <a href="#" class="upload-btn bg-gradient-primary text-white px-6 py-3 rounded-full no-underline font-semibold transition-all duration-300 flex items-center gap-2 hover:-translate-y-0.5 shadow-custom-upload hover:text-white">
            <ion-icon name="add-circle"></ion-icon>
            Upload Pics
          </a>
          <!-- upload dropdown box -->
          <div
            uk-dropdown="pos: top-right;mode:click ; animation: uk-animation-slide-bottom-small"
            class="header_dropdown backdrop-blur-header rounded-2xl shadow-2xl border border-white border-opacity-10 overflow-hidden"
          >
            <!-- notivication header -->
            <div class="px-4 py-3 -mx-5 -mt-4 mb-5 border-b bg-gradient-primary text-white">
              <h4 class="m-0 p-4 font-semibold">Upload Pics</h4>
            </div>

            <!-- notification contents -->
            <div class="flex justify-center flex-center text-center">
              <div class="flex flex-col choose-upload text-center">
                <div
                  class="bg-gray-100 border-2 border-dashed flex flex-col h-24 items-center justify-center relative w-full rounded-lg"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 20 20"
                    fill="currentColor"
                    class="w-12"
                  >
                    <path
                      d="M5.5 13a3.5 3.5 0 01-.369-6.98 4 4 0 117.753-1.977A4.5 4.5 0 1113.5 13H11V9.413l1.293 1.293a1 1 0 001.414-1.414l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13H5.5z"
                    />
                    <path d="M9 13h2v5a1 1 0 11-2 0v-5z" />
                  </svg>
                </div>

                <form
                  action="upload"
                  method="POST"
                  enctype="multipart/form-data"
                >
                  {% csrf_token %}
                  <p class="my-3 leading-6">Upload pics</p>
                  <div>
                    <input type="file" name="image_upload" />
                    <!-- <a href="#" class="button soft-warning small"> Choose file</a> -->
                    <textarea
                      class="button soft-warning small"
                      name="caption"
                      placeholder="caption..."
                    ></textarea>
                    <br />
                    <button class="button bg-blue-700" type="submit">
                      Upload
                    </button>
                  </div>
                </form>

                <!-- <a href="#" class="uk-text-muted mt-3 uk-link"
                            uk-toggle="target: .choose-upload ;  animation: uk-animation-slide-right-small, uk-animation-slide-left-medium; queued: true">
                            Or Import Video </a> -->
              </div>

              <div class="uk-flex uk-flex-column choose-upload" hidden>
                <div
                  class="mx-auto flex flex-col h-24 items-center justify-center relative w-full rounded-lg"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 20 20"
                    fill="currentColor"
                    class="w-12"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M2 9.5A3.5 3.5 0 005.5 13H9v2.586l-1.293-1.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 15.586V13h2.5a4.5 4.5 0 10-.616-8.958 4.002 4.002 0 10-7.753 1.977A3.5 3.5 0 002 9.5zm9 3.5H9V8a1 1 0 012 0v5z"
                      clip-rule="evenodd"
                    />
                  </svg>
                </div>
                <p class="my-3 leading-6">
                  Import videos from YouTube <br />
                  Copy / Paste your video link here
                </p>
                <form class="uk-grid-small" uk-grid>
                  <div class="uk-width-expand">
                    <input
                      type="text"
                      class="uk-input uk-form-small bg-gray-200"
                      style="box-shadow: none"
                      placeholder="Paste link"
                    />
                  </div>
                  <div class="uk-width-auto">
                    <button type="submit" class="button soft-warning -ml-2">
                      Import
                    </button>
                  </div>
                </form>
                <a
                  href="#"
                  class="uk-text-muted mt-3 uk-link"
                  uk-toggle="target: .choose-upload ; animation: uk-animation-slide-left-small, uk-animation-slide-right-medium; queued: true"
                >
                  Or Upload Video
                </a>
              </div>
            </div>
            <div class="px-4 py-3 -mx-5 -mb-4 mt-5 border-t text-sm">
              Your Image size Must be Maxmium 999MB
            </div>
          </div>

          <!-- Notification -->
          <a href="#" class="header-links-item p-2 rounded-full transition-all duration-300 text-white hover:bg-blue-500 hover:bg-opacity-20 hover:scale-110">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              aria-hidden="true"
              role="img"
              width="1.5em"
              height="1.5em"
              preserveAspectRatio="xMidYMid meet"
              viewBox="0 0 24 24"
            >
              <g fill="none">
                <path
                  d="M12 22a2.02 2.02 0 0 1-2.01-2h4a2.02 2.02 0 0 1-.15.78a2.042 2.042 0 0 1-1.44 1.18h-.047A1.922 1.922 0 0 1 12 22zm8-3H4v-2l2-1v-5.5a8.065 8.065 0 0 1 .924-4.06A4.654 4.654 0 0 1 10 4.18V2h4v2.18c2.579.614 4 2.858 4 6.32V16l2 1v2z"
                  fill="currentColor"
                />
              </g>
            </svg>
          </a>
          <div uk-drop="mode: click;offset: 4" class="header_dropdown backdrop-blur-header rounded-2xl shadow-2xl border border-white border-opacity-10 overflow-hidden">
            <h4 class="bg-gradient-primary text-white m-0 p-4 font-semibold">Notification</h4>
            <ul class="dropdown_scrollbar max-h-64 overflow-y-auto" data-simplebar>
              <li>
                <a href="#">
                  <div class="drop_avatar">
                    <img
                      src="{% static 'assets/images/avatars/avatar-1.jpg' %}"
                      alt=""
                    />
                  </div>
                  <div class="drop_content">
                    <p>
                      <strong class="text-link">Taiye</strong>
                      <span class="text-link"> is following you </span>
                    </p>
                    <span class="time-ago"> 2 hours ago </span>
                  </div>
                </a>
              </li>
            </ul>
            <a href="#" class="see-all">See all</a>
          </div>

          <!-- Messages -->
          <a href="#" class="header-links-item p-2 rounded-full transition-all duration-300 text-white hover:bg-blue-500 hover:bg-opacity-20 hover:scale-110">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              aria-hidden="true"
              role="img"
              width="1.5em"
              height="1.5em"
              preserveAspectRatio="xMidYMid meet"
              viewBox="0 0 16 16"
            >
              <g fill="currentColor">
                <path
                  d="M2 0a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h2.5a1 1 0 0 1 .8.4l1.9 2.533a1 1 0 0 0 1.6 0l1.9-2.533a1 1 0 0 1 .8-.4H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"
                />
              </g>
            </svg>
          </a>
          <div uk-drop="mode: click;offset: 4" class="header_dropdown backdrop-blur-header rounded-2xl shadow-2xl border border-white border-opacity-10 overflow-hidden">
            <h4 class="bg-gradient-primary text-white m-0 p-4 font-semibold">Messages</h4>
            <ul class="dropdown_scrollbar max-h-64 overflow-y-auto" data-simplebar>
              <li>
                <a href="#">
                  <div class="drop_avatar">
                    <img
                      src="{% static 'assets/images/avatars/avatar-1.jpg' %}"
                      alt=""
                    />
                  </div>
                  <div class="drop_content">
                    <strong> Taiye </strong> <time> 6:43 PM</time>
                    <p>hi tomi</p>
                  </div>
                </a>
              </li>
            </ul>
            <a href="#" class="see-all">See all</a>
          </div>

          <!-- profile -->
          <a href="#">
            <img
              src="{% if user.profile.profileimg and user.profile.profileimg.url %}{{ user.profile.profileimg.url }}{% else %}/media/profile_pics/blank-profile-picture.png{% endif %}"
              class="header-avatar w-10 h-10 rounded-full border-avatar transition-all duration-300 object-cover shadow-lg hover:scale-110 hover:shadow-xl"
              alt=""
            />
          </a>
          <div
            uk-drop="mode: click;offset:9"
            class="header_dropdown profile_dropdown border-t backdrop-blur-header rounded-2xl shadow-2xl border border-white border-opacity-10 overflow-hidden"
          >
            <ul>
              <li><a href="/settings"> Account setting </a></li>
              <li><a href="logout"> Log Out</a></li>
            </ul>
          </div>
        </div>
      </div>
    </header>

    <div class="container mx-auto my-8 p-8 max-w-full w-full bg-transparent">
      <div class="feed-header bg-gradient-primary text-white p-6 -mx-8 -mt-8 mb-8 rounded-2xl shadow-lg">
        <h1 class="m-0 mb-2 text-3xl font-bold text-shadow-feed">Feed</h1>
        <h2 class="m-0 text-xl font-medium opacity-90 text-shadow-feed-subtitle">Welcome to Social Book!</h2>
      </div>

      <!-- Sidebar Toggle Button -->
      <button class="sidebar-toggle fixed top-1/2 right-5 transform -translate-y-1/2 bg-gradient-primary text-white border-none rounded-full w-15 h-15 cursor-pointer shadow-toggle transition-all duration-300 z-50 hidden items-center justify-center text-2xl hover:scale-110 shadow-toggle-hover" id="sidebarToggle">
        <i class="fa fa-users"></i>
      </button>

      <!-- Sidebar Overlay -->
      <div class="sidebar-overlay fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 z-40 opacity-0 invisible transition-all duration-300 hidden" id="sidebarOverlay"></div>

      <div class="main-layout flex gap-8 max-w-7xl mx-auto px-8 relative items-start">
        <!-- left sidebar-->
        <div class="left-sidebar flex-1 min-w-0 max-w-3xl">
          <div class="flex flex-col space-y-6">
            {% for post in posts %}
            <!-- Example static post -->
            <div class="post-card">
              <!-- post header-->
              <div class="flex justify-between items-center px-4 py-3">
                <div class="flex flex-1 items-center space-x-4">
                  <a href="{% url 'profile' post.user.username %}">
                    <div
                      class="bg-gradient-to-tr from-yellow-600 to-pink-600 p-0.5 rounded-full"
                    >
                      <img
                        src="{% if post.user.profile.profilepic and post.user.profile.profilepic.url %}{{ post.user.profile.profilepic.url }}{% else %}/media/profile_pics/blank-profile-picture.png{% endif %}"
                        alt="Profile Image"
                        class="bg-gray-200 border border-white rounded-full w-8 h-8"
                      />
                    </div>
                  </a>
                  <span class="block font-semibold text-gray-900"
                    ><a href="{% url 'profile' post.user.username %}" class="post-username hover:text-blue-600"
                      >{{ post.user.username }}</a
                    ></span
                  >
                </div>
              <div>
                <a href="#">
                  <i
                    class="icon-feather-more-horizontal text-2xl hover:bg-gray-100 text-gray-600 rounded-full p-2 transition -mr-1"
                  ></i>
                </a>
                <div
                  class="bg-white w-56 shadow-lg mx-auto p-2 mt-12 rounded-md text-gray-900 hidden text-base border border-gray-200"
                  uk-drop="mode: hover;pos: top-right"
                >
                  <ul class="space-y-1">
                    <li>
                      <a
                        href="#"
                        class="flex items-center px-3 py-2 hover:bg-gray-100 hover:text-primary rounded-md"
                      >
                        <i class="uil-share-alt mr-1"></i> Share
                      </a>
                    </li>
                    <li>
                      <a
                        href="#"
                        class="flex items-center px-3 py-2 hover:bg-gray-100 hover:text-primary rounded-md"
                      >
                        <i class="uil-edit-alt mr-1"></i> Edit Post
                      </a>
                    </li>
                    <li>
                      <a
                        href="#"
                        class="flex items-center px-3 py-2 hover:bg-gray-100 hover:text-primary rounded-md"
                      >
                        <i class="uil-comment-slash mr-1"></i> Disable comments
                      </a>
                    </li>
                    <li>
                      <a
                        href="#"
                        class="flex items-center px-3 py-2 hover:bg-gray-100 hover:text-primary rounded-md"
                      >
                        <i class="uil-favorite mr-1"></i> Add favorites
                      </a>
                    </li>
                    <li>
                      <hr class="-mx-2 my-2 border-gray-200" />
                    </li>
                    <li>
                      <a
                        href="#"
                        class="flex items-center px-3 py-2 text-red-500 hover:bg-red-50 hover:text-red-600 rounded-md"
                      >
                        <i class="uil-trash-alt mr-1"></i> Delete Post
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>

            <div uk-lightbox>
              <a href="{{ post.image.url }}">
                <img src="{{ post.image.url }}" alt="Post Image" />
              </a>
            </div>

            <div class="py-3 px-4 space-y-2">
              <p class="post-content">
                <a href="{% url 'profile' post.user.username %}" class="post-username hover:text-blue-600"
                  ><strong>{{ post.user.username }}</strong></a
                >
                <span class="post-caption ml-2">{{ post.caption }}</span>
              </p>

              <div class="flex space-x-4 lg:font-bold">
                <!-- Like button (AJAX) -->
                <input
                  type="hidden"
                  name="csrfmiddlewaretoken"
                  value="{{ csrf_token }}"
                />
                <button
                  type="button"
                  class="like-btn flex items-center space-x-2 bg-transparent border-none cursor-pointer transition-all duration-200 hover:bg-gray-50 rounded-lg p-2"
                  data-post-id="{{ post.id }}"
                  data-liked="{{ post.id|isin:liked_post_ids }}"
                >
                  <div class="p-2 rounded-full action-btn">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                      width="25"
                      height="25"
                      class="like-icon transition-colors duration-200"
                      {%
                      if
                      post.id|isin:liked_post_ids
                      %}
                      style="color: #e41e3f"
                      {%
                      else
                      %}
                      style="color: #65676b"
                      {%
                      endif
                      %}
                    >
                      <path
                        d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 0 0-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z"
                      />
                    </svg>
                  </div>
                </button>

                <!-- comment icon -->
                <button
                  type="button"
                  class="comment-toggle-btn flex items-center space-x-2 bg-transparent border-none cursor-pointer transition-all duration-200 hover:bg-gray-50 rounded-lg p-2"
                  data-post-id="{{ post.id }}"
                >
                  <div
                    class="p-2 rounded-full action-btn hover:bg-gray-100 transition-colors"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                      width="25"
                      height="25"
                      class="comment-icon"
                    >
                      <path
                        fill-rule="evenodd"
                        d="M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2zM7 8H5v2h2V8zm2 0h2v2H9V8zm6 0h-2v2h2V8z"
                        clip-rule="evenodd"
                      />
                    </svg>
                  </div>
                </button>

                <!-- download icon -->
                <a
                  href="{{ post.image.url }}"
                  class="flex items-center space-x-2 flex-1 justify-end action-btn hover:text-primary transition-colors"
                  download
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink"
                    aria-hidden="true"
                    role="img"
                    width="25"
                    height="25"
                    preserveAspectRatio="xMidYMid meet"
                    viewBox="0 0 16 16"
                  >
                    <g fill="currentColor">
                      <path
                        d="M8.5 1.5A1.5 1.5 0 0 1 10 0h4a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h6c-.314.418-.5.937-.5 1.5v6h-2a.5.5 0 0 0-.354.854l2.5 2.5a.5.5 0 0 0 .708 0l2.5-2.5A.5.5 0 0 0 10.5 7.5h-2v-6z"
                      />
                    </g>
                  </svg>
                </a>
                .
              </div>
              <div class="flex space-x-4 lg:font-bold">
                <div class="p-2 rounded-full">
                  <p class="like-count post-meta" data-post-id="{{ post.id }}">
                    Liked by {{ post.no_of_likes }} people
                  </p>
                </div>
              </div>

              <!-- display comments (initially hidden) -->
              <div
                class="comments-section border-t pt-4 hidden transition-all duration-300 ease-in-out"
                data-post-id="{{ post.id }}"
              >
                <div class="comments-fade-overlay">
                  <div
                    class="comments-scroll-container space-y-4"
                    id="comments-container-{{ post.id }}"
                  >
                    {% for comment in post.post_comments %}
                    <div class="flex comment-item">
                      <div
                        class="w-10 h-10 rounded-full relative flex-shrink-0"
                      >
                        <img
                          src="{% if comment.username.profile.profilepic and comment.username.profile.profilepic.url %}{{ comment.username.profile.profilepic.url }}{% else %}/media/profile_pics/blank-profile-picture.png{% endif %}"
                          alt="Profile Image"
                          class="absolute h-full rounded-full w-full"
                        />
                      </div>
                      <div
                        class="text-dark py-2 px-3 rounded-lg bg-gray-50 h-full relative lg:ml-5 ml-2 lg:mr-20"
                      >
                        <p class="leading-6">
                          <a
                            href="{% url 'profile' comment.username.username %}"
                          >
                            <strong class="comment-username"
                              >{{ comment.username.username }}</strong
                            >
                          </a>
                          <span class="comment-text">{{ comment.comment}}</span>
                        </p>
                        <div
                          class="absolute w-3 h-3 top-3 -left-1 bg-gray-50 transform rotate-45"
                        ></div>
                      </div>
                    </div>
                    {% empty %}
                    <div class="text-center post-meta py-4">
                      No comments yet. Be the first to comment!
                    </div>
                    {% endfor %}
                  </div>
                </div>
              </div>

              <!-- comment section box -->
              <div
                class="bg-gray-50 rounded-lg relative border border-gray-200"
              >
                <!-- comment form -->
                <form class="comment-form" data-post-id="{{ post.id }}">
                  {% csrf_token %}
                  <input type="hidden" name="post_id" value="{{ post.id }}" />
                  <input
                    type="text"
                    name="comment"
                    id="comment-{{ post.id }}"
                    placeholder="Write a comment..."
                    class="bg-transparent max-h-10 shadow-none text-dark placeholder-gray-400 w-full px-4 py-2 border-none outline-none"
                    required
                  />
                  <div
                    class="absolute bottom-0 flex h-full items-center right-0 right-3 text-lg space-x-2"
                  >
                    <a href="#" class="text-secondary hover:text-primary"> <i class="uil-image"></i></a>
                    <a href="#" class="text-secondary hover:text-primary"> <i class="uil-video"></i></a>
                    <!-- send button -->
                    <button
                      type="submit"
                      class="hover:text-primary transition-colors text-secondary"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 20 20"
                        fill="currentColor"
                        width="19"
                        height="19"
                        style="transform: rotate(90deg)"
                      >
                        <path
                          d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"
                        />
                      </svg>
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>

        <!-- right sidebar-->
        <div class="right-sidebar" id="rightSidebar">
          <div class="sidebar-card">
            <div class="sidebar-card-header">
              <h2>Users You Can Follow</h2>
            </div>

            <div class="divide-y divide-gray-200">
              <!-- User suggestions -->
              {% for suggestion in suggestions %}
              <div class="flex items-center justify-between py-3">
                <div class="flex flex-1 items-center space-x-4">
                  <a href="{% url 'profile' suggestion.username %}">
                    <img
                      src="{% if suggestion.profile.profilepic and suggestion.profile.profilepic.url %}{{ suggestion.profile.profilepic.url }}{% else %}/media/profile_pics/blank-profile-picture.png{% endif %}"
                      class="bg-gray-600 rounded-full w-10 h-10 object-cover"
                    />
                  </a>
                  <div class="flex flex-col">
                    <span class="block capitalize font-semibold text-dark">
                      {{ suggestion.username }}
                    </span>
                    {% if suggestion.profile.bio %}
                    <span class="text-secondary text-sm">
                      {{ suggestion.profile.bio|truncatewords:3 }}
                    </span>
                    {% endif %}
                  </div>
                </div>

                <a
                  href="{% url 'profile' suggestion.username %}"
                  class="border border-gray-300 font-semibold px-4 py-1 rounded-full text-dark hover:bg-blue-600 hover:text-white hover:border-blue-600 transition-all duration-300"
                >
                  View User
                </a>
              </div>
              {% empty %}
              <div class="flex items-center justify-center py-6 text-secondary">
                <p>No suggestions available</p>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts
    ================================================== -->
    <script src="{% static 'assets/js/tippy.all.min.js' %}"></script>
    <script src="{% static 'assets/js/jquery-3.3.1.min.js' %}"></script>
    <script src="{% static 'assets/js/uikit.js' %}"></script>
    <script src="{% static 'assets/js/simplebar.js' %}"></script>
    <script src="{% static 'assets/js/custom.js' %}"></script>

    <script src="{% static '../../unpkg.com/ionicons%405.2.3/dist/ionicons.js' %}"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Sidebar toggle functionality - Only for larger screens with toggle
        const sidebarToggle = document.getElementById('sidebarToggle');
        const rightSidebar = document.getElementById('rightSidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');

        // Check if toggle elements exist (they're hidden on mobile)
        if (sidebarToggle && window.innerWidth > 768) {
          function toggleSidebar() {
            sidebarToggle.classList.toggle('active');
            rightSidebar.classList.toggle('active');
            sidebarOverlay.classList.toggle('active');
            
            // Update icon
            const icon = sidebarToggle.querySelector('i');
            if (rightSidebar.classList.contains('active')) {
              icon.className = 'fa fa-times';
            } else {
              icon.className = 'fa fa-users';
            }
          }

          sidebarToggle.addEventListener('click', toggleSidebar);
          sidebarOverlay.addEventListener('click', toggleSidebar);
        }

        // Like button functionality
        document.querySelectorAll(".like-btn").forEach(function (button) {
          button.addEventListener("click", function () {
            const postId = button.getAttribute("data-post-id");
            const csrfToken = document.querySelector(
              'input[name="csrfmiddlewaretoken"]'
            ).value;
            button.disabled = true;
            button.style.opacity = "0.6";
            fetch("{% url 'like_post' %}", {
              method: "POST",
              headers: {
                "Content-Type": "application/x-www-form-urlencoded",
                "X-CSRFToken": csrfToken,
              },
              body: `post_id=${postId}`,
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.success) {
                  // Update like count
                  const likeCountElement = document.querySelector(
                    `.like-count[data-post-id="${postId}"]`
                  );
                  if (likeCountElement) {
                    likeCountElement.textContent = `Liked by ${data.no_of_likes} people`;
                  }
                  // Update heart color
                  const likeIcon = button.querySelector(".like-icon");
                  if (likeIcon) {
                    likeIcon.style.color =
                      data.action === "liked" ? "#e41e3f" : "#65676b";
                  }
                }
                button.disabled = false;
                button.style.opacity = "1";
              })
              .catch(() => {
                button.disabled = false;
                button.style.opacity = "1";
              });
          });
        });

        // Comment toggle functionality
        document
          .querySelectorAll(".comment-toggle-btn")
          .forEach(function (button) {
            button.addEventListener("click", function () {
              const postId = button.getAttribute("data-post-id");
              const commentsSection = document.querySelector(
                `.comments-section[data-post-id="${postId}"]`
              );
              const commentIcon = button.querySelector(".comment-icon");
              const fadeOverlay = commentsSection.querySelector(
                ".comments-fade-overlay"
              );
              const scrollContainer = commentsSection.querySelector(
                ".comments-scroll-container"
              );

              if (commentsSection) {
                // Toggle visibility with smooth animation
                if (commentsSection.classList.contains("hidden")) {
                  commentsSection.classList.remove("hidden");
                  setTimeout(() => {
                    commentsSection.style.maxHeight =
                      commentsSection.scrollHeight + "px";
                    commentsSection.style.opacity = "1";

                    // Check if content is scrollable and add fade effect
                    setTimeout(() => {
                      if (
                        scrollContainer.scrollHeight >
                        scrollContainer.clientHeight
                      ) {
                        fadeOverlay.classList.add("show-fade");
                      }
                    }, 100);
                  }, 10);
                  // Change icon color when active
                  commentIcon.style.color = "#1877f2"; // blue-600
                } else {
                  commentsSection.style.maxHeight = "0px";
                  commentsSection.style.opacity = "0";
                  fadeOverlay.classList.remove("show-fade");
                  setTimeout(() => {
                    commentsSection.classList.add("hidden");
                  }, 300);
                  // Reset icon color
                  commentIcon.style.color = "#65676b"; // secondary
                }
              }
            });
          });

        // Handle scroll fade effect
        document
          .querySelectorAll(".comments-scroll-container")
          .forEach(function (container) {
            container.addEventListener("scroll", function () {
              const fadeOverlay = container.closest(".comments-fade-overlay");
              const isNearBottom =
                container.scrollTop + container.clientHeight >=
                container.scrollHeight - 10;

              if (isNearBottom) {
                fadeOverlay.classList.remove("show-fade");
              } else if (container.scrollHeight > container.clientHeight) {
                fadeOverlay.classList.add("show-fade");
              }
            });
          });

        // AJAX Comment submission functionality
        document.querySelectorAll(".comment-form").forEach(function (form) {
          form.addEventListener("submit", function (e) {
            e.preventDefault(); // Prevent default form submission

            const postId = form.getAttribute("data-post-id");
            const commentInput = form.querySelector(`#comment-${postId}`);
            const commentText = commentInput.value.trim();
            const csrfToken = form.querySelector(
              'input[name="csrfmiddlewaretoken"]'
            ).value;
            const submitButton = form.querySelector('button[type="submit"]');

            // Validate comment
            if (!commentText) {
              alert("Please enter a comment");
              return;
            }

            // Disable submit button during request
            submitButton.disabled = true;
            submitButton.style.opacity = "0.6";

            // Send AJAX request
            fetch("{% url 'comment' %}", {
              method: "POST",
              headers: {
                "Content-Type": "application/x-www-form-urlencoded",
                "X-CSRFToken": csrfToken,
              },
              body: `post_id=${postId}&comment=${encodeURIComponent(
                commentText
              )}`,
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.success) {
                  // Clear the input field
                  commentInput.value = "";

                  // Get the comments container
                  const commentsContainer = document.querySelector(
                    `#comments-container-${postId}`
                  );

                  // Remove "no comments" message if it exists
                  const noCommentsMsg = commentsContainer.querySelector(
                    ".text-center.post-meta"
                  );
                  if (noCommentsMsg) {
                    noCommentsMsg.remove();
                  }

                  // Create new comment element
                  const newCommentHTML = `
                    <div class="flex comment-item">
                      <div class="w-10 h-10 rounded-full relative flex-shrink-0">
                        <img
                          src="${data.comment.profile_pic}"
                          alt="Profile Image"
                          class="absolute h-full rounded-full w-full"
                        />
                      </div>
                      <div class="text-dark py-2 px-3 rounded-lg bg-gray-50 h-full relative lg:ml-5 ml-2 lg:mr-20">
                        <p class="leading-6">
                          <a href="/profile/${data.comment.username}">
                            <strong class="comment-username">${data.comment.username}</strong>
                          </a>
                          <span class="comment-text">${data.comment.comment}</span>
                        </p>
                        <div class="absolute w-3 h-3 top-3 -left-1 bg-gray-50 transform rotate-45"></div>
                      </div>
                    </div>
                  `;

                  // Add new comment to the container
                  commentsContainer.insertAdjacentHTML(
                    "beforeend",
                    newCommentHTML
                  );

                  // Check if comments section is visible, if not, open it
                  const commentsSection = document.querySelector(
                    `.comments-section[data-post-id="${postId}"]`
                  );
                  const commentToggleBtn = document.querySelector(
                    `.comment-toggle-btn[data-post-id="${postId}"]`
                  );
                  const commentIcon =
                    commentToggleBtn.querySelector(".comment-icon");

                  if (commentsSection.classList.contains("hidden")) {
                    // Open comments section to show the new comment
                    commentsSection.classList.remove("hidden");
                    setTimeout(() => {
                      commentsSection.style.maxHeight =
                        commentsSection.scrollHeight + "px";
                      commentsSection.style.opacity = "1";

                      // Check for fade effect
                      const fadeOverlay = commentsSection.querySelector(
                        ".comments-fade-overlay"
                      );
                      const scrollContainer = commentsSection.querySelector(
                        ".comments-scroll-container"
                      );
                      setTimeout(() => {
                        if (
                          scrollContainer.scrollHeight >
                          scrollContainer.clientHeight
                        ) {
                          fadeOverlay.classList.add("show-fade");
                        }
                      }, 100);
                    }, 10);
                    // Change icon color when active
                    commentIcon.style.color = "#1877f2";
                  } else {
                    // If already open, update the max-height to accommodate new comment
                    setTimeout(() => {
                      commentsSection.style.maxHeight =
                        commentsSection.scrollHeight + "px";

                      // Check for fade effect
                      const fadeOverlay = commentsSection.querySelector(
                        ".comments-fade-overlay"
                      );
                      const scrollContainer = commentsSection.querySelector(
                        ".comments-scroll-container"
                      );
                      if (
                        scrollContainer.scrollHeight >
                        scrollContainer.clientHeight
                      ) {
                        fadeOverlay.classList.add("show-fade");
                      }
                    }, 10);
                  }

                  // Scroll to the new comment
                  setTimeout(() => {
                    const scrollContainer = commentsContainer;
                    scrollContainer.scrollTop = scrollContainer.scrollHeight;
                  }, 350);
                } else {
                  alert(data.error || "Failed to post comment");
                }

                // Re-enable submit button
                submitButton.disabled = false;
                submitButton.style.opacity = "1";
              })
              .catch((error) => {
                console.error("Error posting comment:", error);
                alert("An error occurred while posting your comment");

                // Re-enable submit button
                submitButton.disabled = false;
                submitButton.style.opacity = "1";
              });
          });
        });
      });
    </script>
  </body>
</html>
