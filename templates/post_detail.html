{# prettier ignore-start #}
{% extends "layout.html" %} 

<!-- extra -->
{% load static %}
{% load socials_extras %} 

<!-- title -->
{% block title %}{{ post.user.username }}'s Post | Social Book{% endblock %} 

<!-- block -->
{% block content %}
<div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  
  <div class="bg-gray-300 rounded-xl shadow-lg mb-4 p-4 flex items-center justify-center">
    <h2 class="text-blue-500 text-xl md:text-3xl font-bold drop-shadow-lg">
        {{ post.user.username }}'s Post
    </h2>
  </div>
  <!-- Saved Post Cards -->

  <div class="bg-white rounded-lg shadow-sm border border-gray-100">
    <!-- Post Header -->
    <div class="p-4 flex items-center justify-between border-b border-gray-100">
      <div class="flex items-center space-x-3">
        <a href="{% url 'profile' post.user.username %}">
          <img
            src="{% if post.user.profile.profilepic and post.user.profile.profilepic.url %}{{ post.user.profile.profilepic.url }}{% else %}/media/profile_pics/blank-profile-picture.png{% endif %}"
            alt="Profile Picture"
            class="w-10 h-10 rounded-full object-cover"
          />
        </a>
        <div>
          <h4 class="text-sm font-semibold text-gray-900">
            <a href="{% url 'profile' post.user.username %}" class="hover:text-blue-600">
              {{ post.user.username }}
            </a>
          </h4>
          <p class="text-xs text-gray-500">
            {{ post.created_at|short_timesince }}
          </p>
        </div>
      </div>
      <!-- Post dropdown menu -->
      <div class="relative">
        <button
          class="text-gray-400 hover:text-gray-600 p-1 rounded-full hover:bg-gray-100 transition-colors post-menu-btn"
          data-post-id="{{ post.id }}"
        >
          <i class="fas fa-ellipsis-h text-sm"></i>
        </button>
        <div
          class="absolute right-0 top-8 bg-white w-48 shadow-lg rounded-md text-gray-900 hidden text-sm border border-gray-200 z-50 post-menu"
          data-post-id="{{ post.id }}"
        >
          <ul class="space-y-1 p-2">
            {% if post.user == user %}
            <li>
              <a
                href="#"
                class="flex items-center px-3 py-2 hover:bg-gray-100 hover:text-blue-600 rounded-md"
              >
                <i class="fas fa-edit mr-2 text-xs"></i> Edit Caption
              </a>
            </li>
            <li>
              <form
                method="POST"
                action="{% url 'delete' post.id %}"
                style="display: inline"
              >
                {% csrf_token %}
                <button
                  type="submit"
                  class="flex items-center w-full px-3 py-2 text-red-500 hover:bg-red-50 hover:text-red-600 rounded-md text-left"
                  onclick="return confirm('Are you sure you want to delete this post?')"
                >
                  <i class="fas fa-trash mr-2 text-xs"></i> Delete Post
                </button>
              </form>
            </li>
            {% endif %}
            <li>
              <a
                href="#"
                class="flex items-center px-3 py-2 hover:bg-gray-100 hover:text-blue-600 rounded-md"
              >
                <i class="fas fa-share mr-2 text-xs"></i> Copy Link
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Post Content -->
    <div class="p-3">
      <!-- Caption (if exists) -->
      {% if post.caption %}
      <p class="text-sm text-gray-800 mb-4">
        {{ post.caption }}
      </p>
      {% endif %}

      <!-- Media display -->
      {% if post.media and post.media_type == 'video' %}
      <div class="rounded-lg overflow-hidden bg-gray-100">
        <video
          src="{{ post.media.url }}"
          class="w-full max-h-96 object-contain"
          controls
          preload="metadata"
        >
          Your browser does not support the video tag.
        </video>
      </div>
      {% elif post.media %}
      <div class="rounded-lg overflow-hidden bg-gray-100">
        <img
          src="{{ post.media.url }}"
          alt="{{ post.caption }}"
          class="post-image"
        />
      </div>
      {% else %}
      <!-- Text-only post styling -->
      <div
        class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border-l-4 border-blue-400"
      >
        <p class="text-sm font-medium text-blue-900">
          {{ post.caption }}
        </p>
      </div>
      {% endif %}
    </div>

    <!-- Engagement Count -->
    <div
      class="px-4 py-2 border-t border-gray-100 flex justify-between items-center text-sm text-gray-500"
    >
      <div class="flex items-center space-x-4">
        <div class="flex items-center space-x-1">
          <div
            class="w-4 h-4 bg-blue-600 rounded-full flex items-center justify-center"
          >
            <i class="fas fa-thumbs-up text-white text-xs"></i>
          </div>
          <span class="like-count" data-post-id="{{ post.id }}"
            >{{ like_count }}</span
          >
        </div>
        <span>{{ comments.count }} comments</span>
      </div>
      {% if post.media %}
      <a
        href="{{ post.media.url }}"
        download
        class="hover:text-gray-600"
      >
        <i class="fas fa-download"></i>
      </a>
      {% endif %}
    </div>

    <!-- Post Actions -->
    <div
      class="px-4 py-3 border-t border-gray-100 flex items-center justify-between"
    >
      <!-- Like button -->
      <button
        type="button"
        class="post-interaction flex items-center justify-center flex-1 like-btn transition-colors duration-200"
        data-post-id="{{ post.id }}"
        data-liked="{{ liked }}"
        style="color: {% if liked %}#1877f2{% else %}#65676b{% endif %}"
      >
        <i class="{% if liked %}fas{% else %}far{% endif %} fa-thumbs-up mr-2 text-lg"></i>
        <span class="text-sm font-medium">{% if liked %}Liked{% else %}Like{% endif %}</span>
      </button>

      <!-- Comment button -->
      <button
        class="post-interaction flex items-center justify-center flex-1"
        onclick="document.getElementById('comment-input').focus()"
      >
        <i class="far fa-comment mr-2 text-lg"></i>
        <span class="text-sm font-medium">Comment</span>
      </button>

      <!-- Share button -->
      <button
        class="post-interaction flex items-center justify-center flex-1"
        onclick="copyPostLink('{{ request.get_host }}/post/{{ post.id }}')"
      >
        <i class="fas fa-share mr-2 text-lg"></i>
        <span class="text-sm font-medium">Share</span>
      </button>
    </div>

    <!-- Comments Section -->
    <div class="border-t border-gray-100">
      <div class="p-4 space-y-3 max-h-96 overflow-y-auto">
        {% for comment in comments %}
        <div class="flex space-x-3">
          <div class="flex-shrink-0">
            <a href="{% url 'profile' comment.username.username %}">
              <img
                src="{% if comment.username.profile.profilepic and comment.username.profile.profilepic.url %}{{ comment.username.profile.profilepic.url }}{% else %}/media/profile_pics/blank-profile-picture.png{% endif %}"
                alt="Profile Image"
                class="w-8 h-8 rounded-full object-cover"
              />
            </a>
          </div>
          <div class="bg-gray-100 rounded-lg px-3 py-2 flex-1">
            <div class="flex items-center justify-between mb-1">
              <a
                href="{% url 'profile' comment.username.username %}"
                class="text-sm font-semibold text-gray-900 hover:text-blue-600"
              >
                {{ comment.username.username }}
              </a>
              <small class="text-xs text-gray-500"
                >{{ comment.created_at|short_timesince }}</small
              >
            </div>
            <p class="text-sm text-gray-800">
              {{ comment.comment }}
            </p>
          </div>
        </div>
        {% empty %}
        <div class="text-center py-4">
          <p class="text-sm text-gray-500">
            No comments yet. Be the first to comment!
          </p>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Comment Form -->
    <div class="p-4 border-t border-gray-100">
      <form class="comment-form" data-post-id="{{ post.id }}">
        {% csrf_token %}
        <input type="hidden" name="post_id" value="{{ post.id }}" />
        <div class="flex items-center space-x-3">
          <img
            src="{% if user.profile.profilepic and user.profile.profilepic.url %}{{ user.profile.profilepic.url }}{% else %}/media/profile_pics/blank-profile-picture.png{% endif %}"
            alt="Your profile"
            class="w-8 h-8 rounded-full object-cover"
          />
          <input
            type="text"
            name="comment"
            id="comment-input"
            placeholder="Write your comment..."
            class="comment-input flex-1 py-2 px-3 focus:outline-none text-sm"
            required
          />
          <button
            type="submit"
            class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors"
          >
            Post
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %} 
{# prettier ignore-end #}
